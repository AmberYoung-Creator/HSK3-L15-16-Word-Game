<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chinese Learning Lab - HSK Level 3</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&family=Noto+Sans+SC:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        * { box-sizing: border-box; }
        body {
            font-family: 'Nunito', sans-serif;
            background-color: #f9f7fe;
            color: #333;
            margin: 0;
            padding: 0;
        }
        .chinese-font {
            font-family: 'Noto Sans SC', sans-serif;
        }
        .card-flip {
            transition: transform 0.6s;
            transform-style: preserve-3d;
        }
        .card-flip.flipped {
            transform: rotateY(180deg);
        }
        .card-front, .card-back {
            backface-visibility: hidden;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        .card-back {
            transform: rotateY(180deg);
        }
        .progress-ring-circle {
            transition: stroke-dashoffset 0.5s;
            transform: rotate(-90deg);
            transform-origin: 50% 50%;
        }
        .game-card {
            transition: all 0.3s ease;
        }
        .game-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }
        .key-btn {
            transition: all 0.2s;
        }
        .key-btn:hover {
            transform: translateY(-2px);
        }
        .key-btn:active {
            transform: translateY(1px);
        }
        .type-correct {
            animation: correctFlash 0.5s;
        }
        .type-incorrect {
            animation: incorrectFlash 0.5s;
        }
        @keyframes correctFlash {
            0% { background-color: #d1fae5; }
            100% { background-color: white; }
        }
        @keyframes incorrectFlash {
            0% { background-color: #fecaca; }
            100% { background-color: white; }
        }
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        .pulse {
            animation: pulse 1s infinite;
        }
    </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-purple-50 to-blue-50">
    <div id="root" class="min-h-screen"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // Vocabulary data - L15 and L16
        const vocabularyData = {
            L15: [
                { chinese: "除了", pinyin: "chúle", english: "other than", russian: "кроме", lesson: "3-L15" },
                { chinese: "发", pinyin: "fā", english: "to send", russian: "отправлять", lesson: "3-L15" },
                { chinese: "花", pinyin: "huā", english: "to spend", russian: "тратить", lesson: "3-L15" },
                { chinese: "极了", pinyin: "jíle", english: "extremely", russian: "чрезвычайно", lesson: "3-L15" },
                { chinese: "街道", pinyin: "jiēdào", english: "street", russian: "улица", lesson: "3-L15" },
                { chinese: "节日", pinyin: "jiérì", english: "festival", russian: "праздник", lesson: "3-L15" },
                { chinese: "句子", pinyin: "jùzi", english: "sentence", russian: "предложение", lesson: "3-L15" },
                { chinese: "练习", pinyin: "liànxí", english: "exercise", russian: "упражнение", lesson: "3-L15" },
                { chinese: "留学", pinyin: "liúxué", english: "to study abroad", russian: "учиться за границей", lesson: "3-L15" },
                { chinese: "其他", pinyin: "qítā", english: "the rest", russian: "остальные", lesson: "3-L15" },
                { chinese: "上网", pinyin: "shàng wǎng", english: "to surf the Internet", russian: "серфить в интернете", lesson: "3-L15" },
                { chinese: "世界", pinyin: "shìjiè", english: "world", russian: "мир", lesson: "3-L15" },
                { chinese: "水平", pinyin: "shuǐpíng", english: "level, standard", russian: "уровень, стандарт", lesson: "3-L15" },
                { chinese: "提高", pinyin: "tígāo", english: "to improve", russian: "улучшать", lesson: "3-L15" },
                { chinese: "完成", pinyin: "wánchéng", english: "to complete", russian: "завершать", lesson: "3-L15" },
                { chinese: "文化", pinyin: "wénhuà", english: "culture", russian: "культура", lesson: "3-L15" },
                { chinese: "新闻", pinyin: "xīnwén", english: "news", russian: "новости", lesson: "3-L15" },
                { chinese: "要求", pinyin: "yāoqiú", english: "requirement", russian: "требование", lesson: "3-L15" },
                { chinese: "注意", pinyin: "zhùyì", english: "to pay attention to", russian: "обращать внимание", lesson: "3-L15" }
            ],
            L16: [
                { chinese: "鼻子", pinyin: "bízi", english: "nose", russian: "нос", lesson: "3-L16" },
                { chinese: "别人", pinyin: "biérén", english: "other people", russian: "другие люди", lesson: "3-L16" },
                { chinese: "城市", pinyin: "chéngshì", english: "city", russian: "город", lesson: "3-L16" },
                { chinese: "公斤", pinyin: "gōngjīn", english: "kilogramme", russian: "килограмм", lesson: "3-L16" },
                { chinese: "关系", pinyin: "guānxi", english: "relationship", russian: "отношения", lesson: "3-L16" },
                { chinese: "检查", pinyin: "jiǎnchá", english: "to check, to examine", russian: "проверять", lesson: "3-L16" },
                { chinese: "可爱", pinyin: "kě'ài", english: "lovely, adorable", russian: "милый, очаровательный", lesson: "3-L16" },
                { chinese: "帽子", pinyin: "màozi", english: "hat, cap", russian: "шляпа, кепка", lesson: "3-L16" },
                { chinese: "米", pinyin: "mǐ", english: "metre", russian: "метр", lesson: "3-L16" },
                { chinese: "皮鞋", pinyin: "píxié", english: "leather shoes", russian: "кожаная обувь", lesson: "3-L16" },
                { chinese: "认为", pinyin: "rènwéi", english: "to think, to believe", russian: "думать, верить", lesson: "3-L16" },
                { chinese: "如果", pinyin: "rúguǒ", english: "if, in case", russian: "если, в случае", lesson: "3-L16" },
                { chinese: "刷牙", pinyin: "shuā yá", english: "to brush the teeth", russian: "чистить зубы", lesson: "3-L16" },
                { chinese: "头发", pinyin: "tóufa", english: "hair", russian: "волосы", lesson: "3-L16" },
                { chinese: "长", pinyin: "zhǎng", english: "to grow, to develop", russian: "расти, развиваться", lesson: "3-L16" }
            ]
        };

        // Combine L15 and L16 for the third deck
        vocabularyData.L15L16 = [...vocabularyData.L15, ...vocabularyData.L16];

        // Initialize progress data structure
        const initializeProgress = () => {
            const progress = {};
            Object.keys(vocabularyData).forEach(deck => {
                vocabularyData[deck].forEach(word => {
                    const key = `${word.chinese}-${word.pinyin}`;
                    if (!progress[key]) {
                        progress[key] = {
                            mastery: 0,
                            lastReviewed: null,
                            reviewCount: 0
                        };
                    }
                });
            });
            return progress;
        };

        // Main App Component
        function App() {
            const [mode, setMode] = useState('flashcard'); // flashcard, quiz, type, game, wordlist
            const [deck, setDeck] = useState('L15'); // L15, L16, L15L16
            const [progress, setProgress] = useState({});
            const [stats, setStats] = useState({ total: 0, mastered: 0, percentage: 0 });
            
            // Load progress from localStorage on initial render
            useEffect(() => {
                const savedProgress = localStorage.getItem('chineseLearningProgress');
                if (savedProgress) {
                    setProgress(JSON.parse(savedProgress));
                } else {
                    const initialProgress = initializeProgress();
                    setProgress(initialProgress);
                    localStorage.setItem('chineseLearningProgress', JSON.stringify(initialProgress));
                }
            }, []);
            
            // Update stats when progress changes
            useEffect(() => {
                const totalWords = Object.keys(progress).length;
                const masteredWords = Object.values(progress).filter(p => p.mastery >= 4).length;
                const percentage = totalWords > 0 ? Math.round((masteredWords / totalWords) * 100) : 0;
                
                setStats({
                    total: totalWords,
                    mastered: masteredWords,
                    percentage: percentage
                });
                
                // Save to localStorage
                localStorage.setItem('chineseLearningProgress', JSON.stringify(progress));
            }, [progress]);
            
            // Update mastery level for a word
            const updateMastery = (wordKey, increment) => {
                setProgress(prev => {
                    const newProgress = { ...prev };
                    if (newProgress[wordKey]) {
                        newProgress[wordKey].mastery = Math.max(0, Math.min(5, newProgress[wordKey].mastery + increment));
                        newProgress[wordKey].lastReviewed = new Date().toISOString();
                        newProgress[wordKey].reviewCount = (newProgress[wordKey].reviewCount || 0) + 1;
                    } else {
                        newProgress[wordKey] = {
                            mastery: Math.max(0, Math.min(5, increment)),
                            lastReviewed: new Date().toISOString(),
                            reviewCount: 1
                        };
                    }
                    return newProgress;
                });
            };
            
            // Reset all progress
            const resetProgress = () => {
                if (window.confirm("Are you sure you want to reset all your progress? This cannot be undone.")) {
                    const initialProgress = initializeProgress();
                    setProgress(initialProgress);
                    localStorage.setItem('chineseLearningProgress', JSON.stringify(initialProgress));
                }
            };
            
            // Speak text using browser's speech synthesis
            const speakText = (text, lang = 'zh-CN') => {
                if ('speechSynthesis' in window) {
                    const utterance = new SpeechSynthesisUtterance(text);
                    utterance.lang = lang;
                    utterance.rate = 0.8;
                    speechSynthesis.speak(utterance);
                } else {
                    alert("Your browser doesn't support speech synthesis. Try Chrome or Edge.");
                }
            };
            
            // Render current mode component
            const renderMode = () => {
                switch(mode) {
                    case 'flashcard': return <FlashcardMode deck={deck} updateMastery={updateMastery} speakText={speakText} progress={progress} />;
                    case 'quiz': return <QuizMode deck={deck} updateMastery={updateMastery} speakText={speakText} />;
                    case 'type': return <TypeMode deck={deck} updateMastery={updateMastery} speakText={speakText} />;
                    case 'game': return <GameMode deck={deck} updateMastery={updateMastery} speakText={speakText} />;
                    case 'wordlist': return <WordlistMode deck={deck} speakText={speakText} progress={progress} />;
                    default: return <FlashcardMode deck={deck} updateMastery={updateMastery} speakText={speakText} progress={progress} />;
                }
            };
            
            return (
                <div className="min-h-screen p-4 md:p-6">
                    {/* Header */}
                    <header className="mb-8 text-center">
                        <h1 className="text-3xl md:text-4xl font-bold text-purple-800 mb-2">
                            <i className="fas fa-language mr-3"></i>
                            Chinese Learning Lab
                        </h1>
                        <p className="text-lg text-gray-600">HSK Level 3 - Interactive Vocabulary Practice</p>
                        
                        {/* Stats Display */}
                        <div className="mt-6 flex flex-wrap justify-center gap-4">
                            <div className="bg-white rounded-xl shadow p-4 flex items-center">
                                <div className="mr-4">
                                    <div className="w-12 h-12 rounded-full bg-blue-100 flex items-center justify-center">
                                        <i className="fas fa-book text-blue-600 text-xl"></i>
                                    </div>
                                </div>
                                <div>
                                    <p className="text-sm text-gray-500">Total Words</p>
                                    <p className="text-2xl font-bold text-gray-800">{stats.total}</p>
                                </div>
                            </div>
                            
                            <div className="bg-white rounded-xl shadow p-4 flex items-center">
                                <div className="mr-4 relative">
                                    <svg className="w-12 h-12" viewBox="0 0 36 36">
                                        <path d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" fill="none" stroke="#e6e6e6" strokeWidth="3"/>
                                        <path className="progress-ring-circle" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" fill="none" stroke="#10b981" strokeWidth="3" strokeDasharray={`${stats.percentage}, 100`}/>
                                    </svg>
                                    <div className="absolute inset-0 flex items-center justify-center">
                                        <span className="text-xs font-bold text-gray-700">{stats.percentage}%</span>
                                    </div>
                                </div>
                                <div>
                                    <p className="text-sm text-gray-500">Mastered</p>
                                    <p className="text-2xl font-bold text-gray-800">{stats.mastered}</p>
                                </div>
                            </div>
                            
                            <div className="bg-white rounded-xl shadow p-4 flex items-center">
                                <div className="mr-4">
                                    <div className="w-12 h-12 rounded-full bg-green-100 flex items-center justify-center">
                                        <i className="fas fa-fire text-green-600 text-xl"></i>
                                    </div>
                                </div>
                                <div>
                                    <p className="text-sm text-gray-500">Current Deck</p>
                                    <p className="text-xl font-bold text-gray-800">Lesson {deck.replace('L', '').replace('15L16', '15 & 16')}</p>
                                </div>
                            </div>
                        </div>
                    </header>
                    
                    <div className="flex flex-col lg:flex-row gap-6">
                        {/* Sidebar - Mode Selection & Deck Selection */}
                        <div className="lg:w-1/4">
                            <div className="bg-white rounded-2xl shadow-lg p-5 mb-6">
                                <h2 className="text-xl font-bold text-gray-800 mb-4 flex items-center">
                                    <i className="fas fa-gamepad mr-2"></i> Learning Modes
                                </h2>
                                <div className="space-y-3">
                                    {[
                                        { id: 'flashcard', icon: 'fa-layer-group', label: 'Flashcards', color: 'bg-purple-500' },
                                        { id: 'quiz', icon: 'fa-question-circle', label: 'Quiz', color: 'bg-blue-500' },
                                        { id: 'type', icon: 'fa-keyboard', label: 'Type It', color: 'bg-green-500' },
                                        { id: 'game', icon: 'fa-puzzle-piece', label: 'Mini-Game', color: 'bg-yellow-500' },
                                        { id: 'wordlist', icon: 'fa-list', label: 'Word List', color: 'bg-indigo-500' }
                                    ].map(item => (
                                        <button
                                            key={item.id}
                                            className={`w-full flex items-center p-3 rounded-xl ${mode === item.id ? 'ring-2 ring-offset-2 ring-opacity-60' : ''} ${mode === item.id ? 'ring-' + item.color.split('-')[1] : 'hover:bg-gray-50'}`}
                                            onClick={() => setMode(item.id)}
                                        >
                                            <div className={`${item.color} w-10 h-10 rounded-lg flex items-center justify-center mr-3`}>
                                                <i className={`fas ${item.icon} text-white`}></i>
                                            </div>
                                            <span className="font-medium text-gray-800">{item.label}</span>
                                        </button>
                                    ))}
                                </div>
                                
                                <div className="mt-8">
                                    <h2 className="text-xl font-bold text-gray-800 mb-4 flex items-center">
                                        <i className="fas fa-folder mr-2"></i> Deck Selection
                                    </h2>
                                    <div className="space-y-3">
                                        {['L15', 'L16', 'L15L16'].map(deckName => (
                                            <button
                                                key={deckName}
                                                className={`w-full text-left p-3 rounded-xl ${deck === deckName ? 'bg-purple-100 border-2 border-purple-300' : 'bg-gray-50 hover:bg-gray-100'}`}
                                                onClick={() => setDeck(deckName)}
                                            >
                                                <div className="flex items-center">
                                                    <i className={`fas fa-book-open mr-3 ${deck === deckName ? 'text-purple-600' : 'text-gray-500'}`}></i>
                                                    <div>
                                                        <p className="font-medium">Lesson {deckName.replace('L', '').replace('15L16', '15 & 16')}</p>
                                                        <p className="text-sm text-gray-500">{vocabularyData[deckName].length} words</p>
                                                    </div>
                                                </div>
                                            </button>
                                        ))}
                                    </div>
                                </div>
                                
                                <div className="mt-8">
                                    <button
                                        className="w-full bg-red-100 hover:bg-red-200 text-red-700 font-medium py-3 rounded-xl flex items-center justify-center"
                                        onClick={resetProgress}
                                    >
                                        <i className="fas fa-redo mr-2"></i> Reset All Progress
                                    </button>
                                    <p className="text-xs text-gray-500 mt-2 text-center">This will reset your mastery levels for all words</p>
                                </div>
                            </div>
                            
                            {/* Keyboard Shortcuts */}
                            <div className="bg-white rounded-2xl shadow-lg p-5">
                                <h2 className="text-xl font-bold text-gray-800 mb-4 flex items-center">
                                    <i className="fas fa-keyboard mr-2"></i> Shortcuts
                                </h2>
                                <div className="grid grid-cols-2 gap-3">
                                    <div className="bg-gray-50 p-3 rounded-lg">
                                        <p className="text-sm font-medium text-gray-700">Space</p>
                                        <p className="text-xs text-gray-500">Flip card</p>
                                    </div>
                                    <div className="bg-gray-50 p-3 rounded-lg">
                                        <p className="text-sm font-medium text-gray-700">K Key</p>
                                        <p className="text-xs text-gray-500">I knew it</p>
                                    </div>
                                    <div className="bg-gray-50 p-3 rounded-lg">
                                        <p className="text-sm font-medium text-gray-700">A Key</p>
                                        <p className="text-xs text-gray-500">Again</p>
                                    </div>
                                    <div className="bg-gray-50 p-3 rounded-lg">
                                        <p className="text-sm font-medium text-gray-700">V Key</p>
                                        <p className="text-xs text-gray-500">Voice</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        {/* Main Content Area */}
                        <div className="lg:w-3/4">
                            <div className="bg-white rounded-2xl shadow-lg p-5 md:p-8 min-h-[500px]">
                                {renderMode()}
                            </div>
                        </div>
                    </div>
                    
                    {/* Footer */}
                    <footer className="mt-10 text-center text-gray-600 text-sm">
                        <p>Designed for HSK Level 3 Chinese learners • Practice Lessons 15 & 16 • Data is saved locally in your browser</p>
                        <p className="mt-2">
                            <i className="fas fa-volume-up mr-1"></i> Uses browser speech synthesis for pronunciation
                        </p>
                    </footer>
                </div>
            );
        }

        // Flashcard Mode Component
        function FlashcardMode({ deck, updateMastery, speakText, progress }) {
            const [currentIndex, setCurrentIndex] = useState(0);
            const [isFlipped, setIsFlipped] = useState(false);
            const [showHint, setShowHint] = useState(false);
            const cardRef = useRef(null);
            
            const words = vocabularyData[deck];
            const currentWord = words[currentIndex];
            const wordKey = `${currentWord.chinese}-${currentWord.pinyin}`;
            const currentProgress = progress[wordKey] || { mastery: 0 };
            
            // Handle keyboard shortcuts
            useEffect(() => {
                const handleKeyDown = (e) => {
                    // Prevent shortcuts from firing when typing in inputs
                    if (e.target.tagName === 'INPUT') return;
                    
                    switch(e.key) {
                        case ' ':
                            e.preventDefault();
                            setIsFlipped(!isFlipped);
                            break;
                        case 'k':
                        case 'K':
                            updateMastery(wordKey, 1);
                            nextCard();
                            break;
                        case 'a':
                        case 'A':
                            updateMastery(wordKey, -1);
                            nextCard();
                            break;
                        case 'v':
                        case 'V':
                            speakText(currentWord.chinese, 'zh-CN');
                            break;
                        case 'ArrowRight':
                            e.preventDefault();
                            nextCard();
                            break;
                        case 'ArrowLeft':
                            e.preventDefault();
                            prevCard();
                            break;
                        default:
                            break;
                    }
                };
                
                window.addEventListener('keydown', handleKeyDown);
                return () => window.removeEventListener('keydown', handleKeyDown);
            }, [isFlipped, currentIndex]);
            
            const nextCard = () => {
                setIsFlipped(false);
                setShowHint(false);
                setCurrentIndex((prev) => (prev + 1) % words.length);
            };
            
            const prevCard = () => {
                setIsFlipped(false);
                setShowHint(false);
                setCurrentIndex((prev) => (prev - 1 + words.length) % words.length);
            };
            
            const handleFlip = () => {
                setIsFlipped(!isFlipped);
            };
            
            const handleMastery = (increment) => {
                updateMastery(wordKey, increment);
                nextCard();
            };
            
            // Mastery level visualization
            const masteryBars = [];
            for (let i = 0; i < 5; i++) {
                masteryBars.push(
                    <div 
                        key={i} 
                        className={`h-2 rounded-full ${i < currentProgress.mastery ? 'bg-green-500' : 'bg-gray-200'}`}
                    ></div>
                );
            }
            
            return (
                <div>
                    <div className="flex justify-between items-center mb-6">
                        <h2 className="text-2xl font-bold text-gray-800 flex items-center">
                            <i className="fas fa-layer-group mr-3 text-purple-600"></i>
                            Flashcards
                        </h2>
                        <div className="text-sm bg-gray-100 px-4 py-2 rounded-full">
                            <span className="font-medium">{currentIndex + 1}</span> of <span className="font-medium">{words.length}</span> words
                        </div>
                    </div>
                    
                    <div className="flex flex-col items-center">
                        {/* Mastery Level Indicator */}
                        <div className="mb-6 w-full max-w-md">
                            <div className="flex justify-between mb-1">
                                <span className="text-sm font-medium text-gray-700">Mastery Level</span>
                                <span className="text-sm font-bold text-green-600">{currentProgress.mastery}/5</span>
                            </div>
                            <div className="grid grid-cols-5 gap-1 mb-2">
                                {masteryBars}
                            </div>
                            <div className="text-xs text-gray-500 text-center">
                                {currentProgress.mastery < 2 ? "Needs practice" : 
                                 currentProgress.mastery < 4 ? "Getting there" : 
                                 "Mastered!"}
                            </div>
                        </div>
                        
                        {/* Flashcard */}
                        <div className="w-full max-w-2xl mb-8">
                            <div 
                                ref={cardRef}
                                className="relative h-64 md:h-80 mx-auto cursor-pointer"
                                onClick={handleFlip}
                            >
                                <div className={`card-flip w-full h-full rounded-2xl ${isFlipped ? 'flipped' : ''}`}>
                                    {/* Card Front - Chinese Character */}
                                    <div className="card-front bg-gradient-to-br from-purple-100 to-blue-100 rounded-2xl shadow-lg border-2 border-purple-200 flex flex-col items-center justify-center p-6">
                                        <div className="text-center">
                                            <div className="chinese-font text-6xl md:text-7xl font-bold text-gray-800 mb-4">
                                                {currentWord.chinese}
                                            </div>
                                            <div className="text-xl text-gray-600 mb-2">{currentWord.pinyin}</div>
                                            <button 
                                                className="mt-4 bg-white bg-opacity-70 hover:bg-opacity-90 px-4 py-2 rounded-full flex items-center mx-auto"
                                                onClick={(e) => {
                                                    e.stopPropagation();
                                                    speakText(currentWord.chinese, 'zh-CN');
                                                }}
                                            >
                                                <i className="fas fa-volume-up mr-2 text-purple-600"></i>
                                                <span>Listen Pronunciation</span>
                                            </button>
                                        </div>
                                        <div className="absolute bottom-4 text-gray-500">
                                            <i className="fas fa-hand-point-up mr-2"></i>
                                            Click or press Space to flip
                                        </div>
                                    </div>
                                    
                                    {/* Card Back - Translations */}
                                    <div className="card-back bg-gradient-to-br from-green-100 to-teal-100 rounded-2xl shadow-lg border-2 border-green-200 flex flex-col items-center justify-center p-6">
                                        <div className="text-center">
                                            <div className="chinese-font text-4xl md:text-5xl font-bold text-gray-800 mb-2">
                                                {currentWord.chinese}
                                            </div>
                                            <div className="text-xl text-gray-600 mb-2">{currentWord.pinyin}</div>
                                            
                                            <div className="bg-white bg-opacity-80 rounded-xl p-4 mb-4 mt-6">
                                                <div className="text-2xl font-bold text-gray-800 mb-1">{currentWord.english}</div>
                                                <div className="text-lg text-gray-700">{currentWord.russian}</div>
                                            </div>
                                            
                                            <div className="flex justify-center space-x-4 mt-6">
                                                <button 
                                                    className="bg-white bg-opacity-70 hover:bg-opacity-90 px-4 py-2 rounded-full flex items-center"
                                                    onClick={(e) => {
                                                        e.stopPropagation();
                                                        speakText(currentWord.chinese, 'zh-CN');
                                                    }}
                                                >
                                                    <i className="fas fa-volume-up mr-2 text-green-600"></i>
                                                    <span>Chinese</span>
                                                </button>
                                                <button 
                                                    className="bg-white bg-opacity-70 hover:bg-opacity-90 px-4 py-2 rounded-full flex items-center"
                                                    onClick={(e) => {
                                                        e.stopPropagation();
                                                        speakText(currentWord.english, 'en-US');
                                                    }}
                                                >
                                                    <i className="fas fa-volume-up mr-2 text-blue-600"></i>
                                                    <span>English</span>
                                                </button>
                                            </div>
                                        </div>
                                        <div className="absolute bottom-4 text-gray-600">
                                            <i className="fas fa-hand-point-up mr-2"></i>
                                            Click or press Space to flip back
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        {/* Controls */}
                        <div className="flex flex-wrap justify-center gap-4 mb-6">
                            <button 
                                className="key-btn bg-red-100 hover:bg-red-200 text-red-700 font-medium px-6 py-3 rounded-xl flex items-center"
                                onClick={() => handleMastery(-1)}
                            >
                                <i className="fas fa-redo mr-2"></i> Again (A)
                            </button>
                            <button 
                                className="key-btn bg-blue-100 hover:bg-blue-200 text-blue-700 font-medium px-6 py-3 rounded-xl flex items-center"
                                onClick={() => setShowHint(!showHint)}
                            >
                                <i className="fas fa-lightbulb mr-2"></i> {showHint ? 'Hide Hint' : 'Show Hint'}
                            </button>
                            <button 
                                className="key-btn bg-green-100 hover:bg-green-200 text-green-700 font-medium px-6 py-3 rounded-xl flex items-center"
                                onClick={() => handleMastery(1)}
                            >
                                <i className="fas fa-check mr-2"></i> I Knew It! (K)
                            </button>
                        </div>
                        
                        {/* Hint */}
                        {showHint && (
                            <div className="bg-yellow-50 border border-yellow-200 rounded-xl p-4 mb-6 max-w-md">
                                <div className="flex items-center mb-2">
                                    <i className="fas fa-lightbulb text-yellow-500 mr-2"></i>
                                    <span className="font-medium">Hint</span>
                                </div>
                                <p className="text-gray-700">This word is from <span className="font-medium">{currentWord.lesson}</span>. It means <span className="font-medium">"{currentWord.english}"</span> in English.</p>
                            </div>
                        )}
                        
                        {/* Navigation */}
                        <div className="flex justify-between w-full max-w-md mt-6">
                            <button 
                                className="bg-gray-100 hover:bg-gray-200 text-gray-800 font-medium px-5 py-2 rounded-xl flex items-center"
                                onClick={prevCard}
                            >
                                <i className="fas fa-arrow-left mr-2"></i> Previous (←)
                            </button>
                            <button 
                                className="bg-purple-100 hover:bg-purple-200 text-purple-700 font-medium px-5 py-2 rounded-xl flex items-center"
                                onClick={nextCard}
                            >
                                Next (→) <i className="fas fa-arrow-right ml-2"></i>
                            </button>
                        </div>
                    </div>
                </div>
            );
        }

        // Quiz Mode Component
        function QuizMode({ deck, updateMastery, speakText }) {
            const [currentIndex, setCurrentIndex] = useState(0);
            const [score, setScore] = useState(0);
            const [quizComplete, setQuizComplete] = useState(false);
            const [selectedOption, setSelectedOption] = useState(null);
            const [feedback, setFeedback] = useState('');
            
            const words = vocabularyData[deck];
            const currentWord = words[currentIndex];
            const wordKey = `${currentWord.chinese}-${currentWord.pinyin}`;
            
            // Generate multiple choice options
            const generateOptions = () => {
                const correctAnswer = currentWord.english;
                const otherWords = words.filter((_, i) => i !== currentIndex);
                const randomWords = [...otherWords]
                    .sort(() => Math.random() - 0.5)
                    .slice(0, 3)
                    .map(w => w.english);
                
                const options = [correctAnswer, ...randomWords];
                return options.sort(() => Math.random() - 0.5);
            };
            
            const [options, setOptions] = useState(generateOptions());
            
            // Reset options when current word changes
            useEffect(() => {
                setOptions(generateOptions());
                setSelectedOption(null);
                setFeedback('');
            }, [currentIndex]);
            
            const handleAnswer = (option) => {
                if (selectedOption) return; // Prevent multiple selections
                
                setSelectedOption(option);
                const isCorrect = option === currentWord.english;
                
                if (isCorrect) {
                    setScore(prev => prev + 1);
                    setFeedback('Correct! Well done!');
                    updateMastery(wordKey, 1);
                } else {
                    setFeedback(`Incorrect. The correct answer is: ${currentWord.english}`);
                    updateMastery(wordKey, -1);
                }
                
                // Move to next question after delay
                setTimeout(() => {
                    if (currentIndex + 1 < words.length) {
                        setCurrentIndex(prev => prev + 1);
                    } else {
                        setQuizComplete(true);
                    }
                }, 1500);
            };
            
            const restartQuiz = () => {
                setCurrentIndex(0);
                setScore(0);
                setQuizComplete(false);
                setSelectedOption(null);
                setFeedback('');
                setOptions(generateOptions());
            };
            
            if (quizComplete) {
                return (
                    <div className="text-center py-8">
                        <h2 className="text-2xl font-bold text-gray-800 mb-6 flex items-center justify-center">
                            <i className="fas fa-poll mr-3 text-blue-600"></i>
                            Quiz Complete!
                        </h2>
                        
                        <div className="bg-gradient-to-r from-blue-50 to-indigo-50 rounded-2xl p-8 max-w-md mx-auto mb-8">
                            <div className="text-6xl font-bold text-blue-600 mb-2">{score}/{words.length}</div>
                            <div className="text-xl text-gray-700 mb-4">
                                {score === words.length ? "Perfect score! Amazing!" : 
                                 score >= words.length * 0.7 ? "Great job! You're doing well!" :
                                 "Keep practicing, you'll get better!"}
                            </div>
                            <div className="w-full bg-gray-200 rounded-full h-4 mb-2">
                                <div 
                                    className="bg-blue-600 h-4 rounded-full" 
                                    style={{ width: `${(score / words.length) * 100}%` }}
                                ></div>
                            </div>
                            <p className="text-gray-600">{Math.round((score / words.length) * 100)}% correct</p>
                        </div>
                        
                        <button 
                            className="bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-8 rounded-xl text-lg"
                            onClick={restartQuiz}
                        >
                            <i className="fas fa-redo mr-2"></i> Try Again
                        </button>
                    </div>
                );
            }
            
            return (
                <div>
                    <div className="flex justify-between items-center mb-8">
                        <h2 className="text-2xl font-bold text-gray-800 flex items-center">
                            <i className="fas fa-question-circle mr-3 text-blue-600"></i>
                            Multiple Choice Quiz
                        </h2>
                        <div className="text-lg bg-blue-100 text-blue-800 font-bold px-5 py-2 rounded-full">
                            <span>{currentIndex + 1}</span> / <span>{words.length}</span>
                        </div>
                    </div>
                    
                    <div className="flex flex-col items-center">
                        {/* Question */}
                        <div className="bg-gradient-to-r from-blue-100 to-indigo-100 rounded-2xl p-8 mb-8 w-full max-w-2xl text-center">
                            <div className="chinese-font text-5xl md:text-6xl font-bold text-gray-800 mb-4">
                                {currentWord.chinese}
                            </div>
                            <div className="text-2xl text-gray-600 mb-2">{currentWord.pinyin}</div>
                            
                            <button 
                                className="mt-4 bg-white hover:bg-gray-50 px-5 py-2 rounded-full flex items-center mx-auto"
                                onClick={() => speakText(currentWord.chinese, 'zh-CN')}
                            >
                                <i className="fas fa-volume-up mr-2 text-blue-600"></i>
                                <span>Listen to pronunciation</span>
                            </button>
                        </div>
                        
                        <p className="text-xl font-medium text-gray-700 mb-6">What does this word mean in English?</p>
                        
                        {/* Options */}
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4 w-full max-w-3xl mb-8">
                            {options.map((option, idx) => {
                                let btnClass = "bg-white hover:bg-gray-50 border-2 border-gray-200 text-gray-800";
                                
                                if (selectedOption) {
                                    if (option === currentWord.english) {
                                        btnClass = "bg-green-100 border-2 border-green-400 text-green-800";
                                    } else if (option === selectedOption && option !== currentWord.english) {
                                        btnClass = "bg-red-100 border-2 border-red-400 text-red-800";
                                    } else {
                                        btnClass = "bg-gray-100 border-2 border-gray-200 text-gray-500";
                                    }
                                }
                                
                                return (
                                    <button
                                        key={idx}
                                        className={`${btnClass} font-medium text-lg p-5 rounded-xl text-left transition-all duration-200 ${!selectedOption ? 'hover:scale-[1.02]' : ''}`}
                                        onClick={() => handleAnswer(option)}
                                        disabled={!!selectedOption}
                                    >
                                        <div className="flex items-center">
                                            <div className={`w-8 h-8 rounded-full flex items-center justify-center mr-4 ${selectedOption ? (option === currentWord.english ? 'bg-green-500 text-white' : option === selectedOption ? 'bg-red-500 text-white' : 'bg-gray-300 text-gray-600') : 'bg-blue-100 text-blue-700'}`}>
                                                {String.fromCharCode(65 + idx)}
                                            </div>
                                            <span>{option}</span>
                                        </div>
                                    </button>
                                );
                            })}
                        </div>
                        
                        {/* Feedback */}
                        {feedback && (
                            <div className={`p-4 rounded-xl mb-6 w-full max-w-2xl ${feedback.startsWith('Correct') ? 'bg-green-50 text-green-800 border border-green-200' : 'bg-red-50 text-red-800 border border-red-200'}`}>
                                <div className="flex items-center">
                                    <i className={`fas ${feedback.startsWith('Correct') ? 'fa-check-circle' : 'fa-times-circle'} mr-3 text-xl`}></i>
                                    <span className="font-medium">{feedback}</span>
                                </div>
                            </div>
                        )}
                        
                        {/* Progress */}
                        <div className="mt-4 w-full max-w-2xl">
                            <div className="flex justify-between mb-1">
                                <span className="text-gray-700">Your score: <span className="font-bold">{score}</span> correct</span>
                                <span className="text-gray-700">Progress</span>
                            </div>
                            <div className="w-full bg-gray-200 rounded-full h-3">
                                <div 
                                    className="bg-blue-600 h-3 rounded-full" 
                                    style={{ width: `${((currentIndex + 1) / words.length) * 100}%` }}
                                ></div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        // Type Mode Component
        function TypeMode({ deck, updateMastery, speakText }) {
            const [currentIndex, setCurrentIndex] = useState(0);
            const [inputValue, setInputValue] = useState('');
            const [feedback, setFeedback] = useState('');
            const [isCorrect, setIsCorrect] = useState(null);
            const [score, setScore] = useState(0);
            const inputRef = useRef(null);
            
            const words = vocabularyData[deck];
            const currentWord = words[currentIndex];
            const wordKey = `${currentWord.chinese}-${currentWord.pinyin}`;
            
            useEffect(() => {
                if (inputRef.current) {
                    inputRef.current.focus();
                }
            }, [currentIndex]);
            
            const handleSubmit = (e) => {
                e.preventDefault();
                if (!inputValue.trim()) return;
                
                const isAnswerCorrect = inputValue.trim() === currentWord.chinese;
                setIsCorrect(isAnswerCorrect);
                
                if (isAnswerCorrect) {
                    setFeedback('Correct! Well done!');
                    setScore(prev => prev + 1);
                    updateMastery(wordKey, 1);
                    
                    // Clear input and move to next word after delay
                    setTimeout(() => {
                        setInputValue('');
                        setFeedback('');
                        setIsCorrect(null);
                        setCurrentIndex(prev => (prev + 1) % words.length);
                    }, 1200);
                } else {
                    setFeedback(`Incorrect. Try again! The correct answer is: ${currentWord.chinese}`);
                    updateMastery(wordKey, -1);
                    
                    // Clear input but don't move to next word
                    setTimeout(() => {
                        setInputValue('');
                        setFeedback('');
                        setIsCorrect(null);
                    }, 2000);
                }
            };
            
            const handleSkip = () => {
                setInputValue('');
                setFeedback('');
                setIsCorrect(null);
                setCurrentIndex(prev => (prev + 1) % words.length);
            };
            
            return (
                <div>
                    <div className="flex justify-between items-center mb-8">
                        <h2 className="text-2xl font-bold text-gray-800 flex items-center">
                            <i className="fas fa-keyboard mr-3 text-green-600"></i>
                            Type It - Character Practice
                        </h2>
                        <div className="text-lg bg-green-100 text-green-800 font-bold px-5 py-2 rounded-full">
                            Score: <span>{score}</span>
                        </div>
                    </div>
                    
                    <div className="flex flex-col items-center">
                        {/* Prompt */}
                        <div className="bg-gradient-to-r from-green-100 to-teal-100 rounded-2xl p-8 mb-8 w-full max-w-2xl text-center">
                            <p className="text-xl text-gray-700 mb-4">Type the Chinese characters for:</p>
                            <div className="text-3xl font-bold text-gray-800 mb-2">{currentWord.english}</div>
                            <div className="text-xl text-gray-600 mb-4">{currentWord.russian}</div>
                            
                            <div className="flex justify-center space-x-4">
                                <button 
                                    className="bg-white hover:bg-gray-50 px-4 py-2 rounded-full flex items-center"
                                    onClick={() => speakText(currentWord.english, 'en-US')}
                                >
                                    <i className="fas fa-volume-up mr-2 text-blue-600"></i>
                                    <span>English</span>
                                </button>
                                <button 
                                    className="bg-white hover:bg-gray-50 px-4 py-2 rounded-full flex items-center"
                                    onClick={() => speakText(currentWord.chinese, 'zh-CN')}
                                >
                                    <i className="fas fa-volume-up mr-2 text-green-600"></i>
                                    <span>Chinese</span>
                                </button>
                            </div>
                        </div>
                        
                        {/* Input Form */}
                        <form onSubmit={handleSubmit} className="w-full max-w-2xl mb-8">
                            <div className="flex flex-col md:flex-row gap-4">
                                <div className="flex-grow">
                                    <input
                                        ref={inputRef}
                                        type="text"
                                        value={inputValue}
                                        onChange={(e) => setInputValue(e.target.value)}
                                        className={`w-full p-4 text-2xl border-2 rounded-xl text-center chinese-font ${isCorrect === true ? 'type-correct border-green-500' : isCorrect === false ? 'type-incorrect border-red-500' : 'border-gray-300'}`}
                                        placeholder="Type the Chinese characters here..."
                                        autoFocus
                                    />
                                </div>
                                <div className="flex gap-4">
                                    <button 
                                        type="submit"
                                        className="bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-6 rounded-xl text-lg"
                                    >
                                        <i className="fas fa-check mr-2"></i> Check
                                    </button>
                                    <button 
                                        type="button"
                                        className="bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold py-3 px-6 rounded-xl text-lg"
                                        onClick={handleSkip}
                                    >
                                        <i className="fas fa-forward mr-2"></i> Skip
                                    </button>
                                </div>
                            </div>
                        </form>
                        
                        {/* Feedback */}
                        {feedback && (
                            <div className={`p-4 rounded-xl mb-6 w-full max-w-2xl ${isCorrect ? 'bg-green-50 text-green-800 border border-green-200' : 'bg-red-50 text-red-800 border border-red-200'}`}>
                                <div className="flex items-center justify-center">
                                    <i className={`fas ${isCorrect ? 'fa-check-circle' : 'fa-times-circle'} mr-3 text-xl`}></i>
                                    <span className="font-medium text-lg">{feedback}</span>
                                </div>
                            </div>
                        )}
                        
                        {/* Hint */}
                        <div className="bg-blue-50 border border-blue-200 rounded-xl p-4 mb-6 w-full max-w-2xl">
                            <div className="flex items-center mb-2">
                                <i className="fas fa-info-circle text-blue-500 mr-2"></i>
                                <span className="font-medium">Hint</span>
                            </div>
                            <p className="text-gray-700">
                                Pinyin: <span className="font-medium">{currentWord.pinyin}</span>
                            </p>
                            <p className="text-gray-700 mt-1">
                                Lesson: <span className="font-medium">{currentWord.lesson}</span>
                            </p>
                        </div>
                        
                        {/* Progress */}
                        <div className="mt-4 w-full max-w-2xl">
                            <div className="flex justify-between mb-1">
                                <span className="text-gray-700">Current word: <span className="font-bold">{currentIndex + 1}</span> of <span className="font-bold">{words.length}</span></span>
                            </div>
                            <div className="w-full bg-gray-200 rounded-full h-3">
                                <div 
                                    className="bg-green-600 h-3 rounded-full" 
                                    style={{ width: `${((currentIndex + 1) / words.length) * 100}%` }}
                                ></div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        // Game Mode Component (Matching Game)
        function GameMode({ deck, updateMastery, speakText }) {
            const [gameWords, setGameWords] = useState([]);
            const [matchedPairs, setMatchedPairs] = useState([]);
            const [selectedCards, setSelectedCards] = useState([]);
            const [moves, setMoves] = useState(0);
            const [gameComplete, setGameComplete] = useState(false);
            const [showCelebration, setShowCelebration] = useState(false);
            
            // Initialize game
            useEffect(() => {
                setupGame();
            }, [deck]);
            
            const setupGame = () => {
                // Get 8 random words from the deck
                const allWords = vocabularyData[deck];
                const shuffled = [...allWords].sort(() => Math.random() - 0.5).slice(0, 8);
                
                // Create pairs (Chinese + English)
                const pairs = [];
                shuffled.forEach(word => {
                    pairs.push({
                        id: `${word.chinese}-chinese`,
                        type: 'chinese',
                        content: word.chinese,
                        matchId: word.chinese,
                        word: word
                    });
                    
                    pairs.push({
                        id: `${word.chinese}-english`,
                        type: 'english',
                        content: word.english,
                        matchId: word.chinese,
                        word: word
                    });
                });
                
                // Shuffle the pairs
                const shuffledPairs = pairs.sort(() => Math.random() - 0.5);
                setGameWords(shuffledPairs);
                setMatchedPairs([]);
                setSelectedCards([]);
                setMoves(0);
                setGameComplete(false);
            };
            
            const handleCardClick = (card) => {
                // Ignore if card is already matched or selected
                if (matchedPairs.includes(card.matchId) || selectedCards.find(c => c.id === card.id)) {
                    return;
                }
                
                // If two cards are already selected, ignore
                if (selectedCards.length >= 2) return;
                
                const newSelected = [...selectedCards, card];
                setSelectedCards(newSelected);
                
                // If two cards are selected, check for match
                if (newSelected.length === 2) {
                    setMoves(prev => prev + 1);
                    
                    const [card1, card2] = newSelected;
                    
                    // Check if they match
                    if (card1.matchId === card2.matchId) {
                        // Match found
                        setMatchedPairs(prev => [...prev, card1.matchId]);
                        setSelectedCards([]);
                        
                        // Update mastery for the matched word
                        const wordKey = `${card1.word.chinese}-${card1.word.pinyin}`;
                        updateMastery(wordKey, 1);
                        
                        // Speak the word
                        speakText(card1.word.chinese, 'zh-CN');
                        
                        // Check if game is complete
                        if (matchedPairs.length + 1 === gameWords.length / 2) {
                            setTimeout(() => {
                                setGameComplete(true);
                                setShowCelebration(true);
                                setTimeout(() => setShowCelebration(false), 3000);
                            }, 500);
                        }
                    } else {
                        // No match, flip cards back after delay
                        setTimeout(() => {
                            setSelectedCards([]);
                        }, 1000);
                    }
                }
            };
            
            return (
                <div>
                    <div className="flex justify-between items-center mb-8">
                        <h2 className="text-2xl font-bold text-gray-800 flex items-center">
                            <i className="fas fa-puzzle-piece mr-3 text-yellow-600"></i>
                            Matching Game
                        </h2>
                        <div className="flex items-center space-x-4">
                            <div className="text-lg bg-yellow-100 text-yellow-800 font-bold px-5 py-2 rounded-full">
                                Moves: <span>{moves}</span>
                            </div>
                            <div className="text-lg bg-green-100 text-green-800 font-bold px-5 py-2 rounded-full">
                                Matched: <span>{matchedPairs.length}</span>/<span>{gameWords.length/2}</span>
                            </div>
                        </div>
                    </div>
                    
                    {gameComplete ? (
                        <div className="text-center py-8">
                            <div className="bg-gradient-to-r from-yellow-50 to-orange-50 rounded-2xl p-8 max-w-md mx-auto mb-8">
                                <div className="text-5xl mb-4">🎉</div>
                                <div className="text-3xl font-bold text-gray-800 mb-2">Congratulations!</div>
                                <div className="text-xl text-gray-700 mb-4">You matched all pairs in {moves} moves!</div>
                                <div className="text-lg text-gray-600 mb-6">Great job practicing your Chinese vocabulary!</div>
                                
                                <button 
                                    className="bg-yellow-500 hover:bg-yellow-600 text-white font-bold py-3 px-8 rounded-xl text-lg"
                                    onClick={setupGame}
                                >
                                    <i className="fas fa-redo mr-2"></i> Play Again
                                </button>
                            </div>
                        </div>
                    ) : (
                        <div>
                            <p className="text-center text-gray-700 mb-8 text-lg">
                                Match each Chinese character with its English translation
                            </p>
                            
                            {/* Game Board */}
                            <div className="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
                                {gameWords.map(card => {
                                    const isSelected = selectedCards.find(c => c.id === card.id);
                                    const isMatched = matchedPairs.includes(card.matchId);
                                    let cardClass = "game-card bg-white border-2 border-gray-200 p-4 rounded-xl h-32 flex items-center justify-center cursor-pointer";
                                    
                                    if (isMatched) {
                                        cardClass = "game-card bg-green-100 border-2 border-green-400 p-4 rounded-xl h-32 flex items-center justify-center cursor-pointer";
                                    } else if (isSelected) {
                                        cardClass = "game-card bg-blue-100 border-2 border-blue-400 p-4 rounded-xl h-32 flex items-center justify-center cursor-pointer";
                                    }
                                    
                                    return (
                                        <div 
                                            key={card.id}
                                            className={cardClass}
                                            onClick={() => handleCardClick(card)}
                                        >
                                            <div className="text-center">
                                                <div className={`${card.type === 'chinese' ? 'chinese-font text-3xl font-bold' : 'text-xl font-medium'}`}>
                                                    {card.content}
                                                </div>
                                                {isMatched && (
                                                    <div className="mt-2 text-sm text-green-700 flex items-center justify-center">
                                                        <i className="fas fa-check mr-1"></i> Matched!
                                                    </div>
                                                )}
                                            </div>
                                        </div>
                                    );
                                })}
                            </div>
                            
                            {/* Instructions */}
                            <div className="bg-blue-50 border border-blue-200 rounded-xl p-4 mb-6">
                                <div className="flex items-center mb-2">
                                    <i className="fas fa-info-circle text-blue-500 mr-2"></i>
                                    <span className="font-medium">How to play</span>
                                </div>
                                <p className="text-gray-700">
                                    Click on a card to reveal it, then try to find its matching pair (Chinese character with its English meaning).
                                    Match all pairs to win the game!
                                </p>
                            </div>
                            
                            <div className="flex justify-center">
                                <button 
                                    className="bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold py-3 px-8 rounded-xl text-lg"
                                    onClick={setupGame}
                                >
                                    <i className="fas fa-sync-alt mr-2"></i> Restart Game
                                </button>
                            </div>
                        </div>
                    )}
                    
                    {/* Celebration animation */}
                    {showCelebration && (
                        <div className="fixed inset-0 pointer-events-none flex items-center justify-center z-50">
                            <div className="text-6xl animate-pulse">
                                🎉
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        // Wordlist Mode Component
        function WordlistMode({ deck, speakText, progress }) {
            const [filter, setFilter] = useState('all'); // all, mastered, practicing
            const [sortBy, setSortBy] = useState('default'); // default, mastery, alphabet
            
            const words = vocabularyData[deck];
            
            // Filter and sort words
            const filteredWords = words.filter(word => {
                const wordKey = `${word.chinese}-${word.pinyin}`;
                const wordProgress = progress[wordKey] || { mastery: 0 };
                
                if (filter === 'mastered') return wordProgress.mastery >= 4;
                if (filter === 'practicing') return wordProgress.mastery < 4;
                return true; // 'all'
            }).sort((a, b) => {
                const aKey = `${a.chinese}-${a.pinyin}`;
                const bKey = `${b.chinese}-${b.pinyin}`;
                const aProgress = progress[aKey] || { mastery: 0 };
                const bProgress = progress[bKey] || { mastery: 0 };
                
                if (sortBy === 'mastery') {
                    return bProgress.mastery - aProgress.mastery;
                } else if (sortBy === 'alphabet') {
                    return a.english.localeCompare(b.english);
                }
                // default: by lesson order
                return 0;
            });
            
            return (
                <div>
                    <div className="flex justify-between items-center mb-8">
                        <h2 className="text-2xl font-bold text-gray-800 flex items-center">
                            <i className="fas fa-list mr-3 text-indigo-600"></i>
                            Word List Reference
                        </h2>
                        <div className="text-lg bg-indigo-100 text-indigo-800 font-bold px-5 py-2 rounded-full">
                            {filteredWords.length} words
                        </div>
                    </div>
                    
                    {/* Controls */}
                    <div className="flex flex-wrap gap-4 mb-8">
                        <div>
                            <label className="block text-sm font-medium text-gray-700 mb-1">Filter by mastery:</label>
                            <div className="flex space-x-2">
                                {['all', 'mastered', 'practicing'].map(option => (
                                    <button
                                        key={option}
                                        className={`px-4 py-2 rounded-full ${filter === option ? 'bg-indigo-500 text-white' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'}`}
                                        onClick={() => setFilter(option)}
                                    >
                                        {option.charAt(0).toUpperCase() + option.slice(1)}
                                    </button>
                                ))}
                            </div>
                        </div>
                        
                        <div>
                            <label className="block text-sm font-medium text-gray-700 mb-1">Sort by:</label>
                            <div className="flex space-x-2">
                                {['default', 'mastery', 'alphabet'].map(option => (
                                    <button
                                        key={option}
                                        className={`px-4 py-2 rounded-full ${sortBy === option ? 'bg-indigo-500 text-white' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'}`}
                                        onClick={() => setSortBy(option)}
                                    >
                                        {option.charAt(0).toUpperCase() + option.slice(1)}
                                    </button>
                                ))}
                            </div>
                        </div>
                    </div>
                    
                    {/* Word List */}
                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        {filteredWords.map((word, idx) => {
                            const wordKey = `${word.chinese}-${word.pinyin}`;
                            const wordProgress = progress[wordKey] || { mastery: 0 };
                            
                            return (
                                <div key={idx} className="bg-gray-50 border border-gray-200 rounded-xl p-5 hover:shadow-md transition-shadow">
                                    <div className="flex justify-between items-start mb-3">
                                        <div className="chinese-font text-3xl font-bold text-gray-800">
                                            {word.chinese}
                                        </div>
                                        <button 
                                            className="bg-white hover:bg-gray-100 w-10 h-10 rounded-full flex items-center justify-center"
                                            onClick={() => speakText(word.chinese, 'zh-CN')}
                                        >
                                            <i className="fas fa-volume-up text-indigo-600"></i>
                                        </button>
                                    </div>
                                    
                                    <div className="text-lg text-gray-600 mb-2">{word.pinyin}</div>
                                    
                                    <div className="mb-3">
                                        <div className="font-medium text-gray-800">{word.english}</div>
                                        <div className="text-gray-700">{word.russian}</div>
                                    </div>
                                    
                                    <div className="flex items-center justify-between">
                                        <div className="text-sm text-gray-500">Lesson {word.lesson}</div>
                                        <div className="flex items-center">
                                            <div className="flex mr-2">
                                                {[...Array(5)].map((_, i) => (
                                                    <div 
                                                        key={i} 
                                                        className={`w-2 h-2 rounded-full mx-0.5 ${i < wordProgress.mastery ? 'bg-green-500' : 'bg-gray-300'}`}
                                                    ></div>
                                                ))}
                                            </div>
                                            <span className="text-sm font-medium text-gray-700">{wordProgress.mastery}/5</span>
                                        </div>
                                    </div>
                                </div>
                            );
                        })}
                    </div>
                    
                    {filteredWords.length === 0 && (
                        <div className="text-center py-12">
                            <div className="text-5xl mb-4">📝</div>
                            <div className="text-xl text-gray-700">No words match your current filter.</div>
                            <button 
                                className="mt-4 bg-indigo-100 hover:bg-indigo-200 text-indigo-700 font-medium py-2 px-6 rounded-full"
                                onClick={() => setFilter('all')}
                            >
                                Show all words
                            </button>
                        </div>
                    )}
                </div>
            );
        }

        // Render the app
        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
